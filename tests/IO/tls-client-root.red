Red [
    title: "Basic Secure TCP test client"
]

root-cert: {
-----BEGIN CERTIFICATE-----
MIIEDDCCAvSgAwIBAgIIZLM7o/nXzsgwDQYJKoZIhvcNAQELBQAwgYgxCzAJBgNV
BAYTAkNOMRUwEwYDVQQKEwxiaXRiZWdpbi5jb20xHzAdBgNVBAsTFmJpdGJlZ2lu
IHRlc3QgcnNhIHJvb3QxHjAcBgNVBAMTFXJzYS5yb290LmJpdGJlZ2luLmNvbTEh
MB8GCSqGSIb3DQEJAQwSYml0YmVnaW5AZ21haWwuY29tMB4XDTIwMDczMDAzMzUx
MVoXDTIxMDczMDAzMzUxMVowgYgxCzAJBgNVBAYTAkNOMRUwEwYDVQQKEwxiaXRi
ZWdpbi5jb20xHzAdBgNVBAsTFmJpdGJlZ2luIHRlc3QgcnNhIHJvb3QxHjAcBgNV
BAMTFXJzYS5yb290LmJpdGJlZ2luLmNvbTEhMB8GCSqGSIb3DQEJAQwSYml0YmVn
aW5AZ21haWwuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApLQN
YBZkscZY9TXprHGMve7pUlnmm+OvANgabnSCQEDZeYr0FFQ7y8LGP/XWCmr+Fyd+
rJjvwhmSGD3ZKOEqOc3LJkaUCccK3RxeGuGDLDKJ2GX1DtCkXwtQF//SQSA8mpFR
48L9nbITvxPuqN7V1oGV2yXFWUpyQ9kbxKBrrG0eh2PArrDFr97hFbugZ5Stnqrx
5VEHSLzk+T8LQrkJsMaBlsJMLWpLdSe6Xn4XesMf+vBgMC980mhy4aOIF656qrNP
XAgZGVZ8I9TGKVmdtdVhaDNIn+Do24GYZooRInC+LhK2McV+/5LT1aPDDlVq8mZF
eWKY5MLBrPu0r4Gi2QIDAQABo3gwdjAOBgNVHQ8BAf8EBAMCAYYwDwYDVR0TAQH/
BAUwAwEB/zAdBgNVHQ4EFgQUSrI4ssbNCyj0lBgoYJQgvxBW9vEwNAYDVR0RBC0w
K4IVcnNhLnJvb3QuYml0YmVnaW4uY29tgRJiaXRiZWdpbkBnbWFpbC5jb20wDQYJ
KoZIhvcNAQELBQADggEBAGAhy+qZNy6cCbV0RAHIe28h0OqpUKC0fHG19McRc+hu
22YW7rCt9629S2WJEw2PsQQZ2dV/QA0aEvQ58J8Cgp5PUoSZLQ40uvLZUpVu5CcR
ZTp/9rd/I9wQnoPFwlEYoRbgda+UkdurYMn1gCyC54+4hfHljkdwNQD1T85xlPNs
gFGYm2qMeSp5xnPUvknfS38b9go8ooGZIoCYxFbClNxXRTVydV4rvCdjuziJ74ck
2/swOQIx7WZd8pNezHJbZ2b7K4/6knBHrsNOLxuS9My04pH1fkY3mD42yqf+ichf
VWbx33V8buqISWiaIADGdKYY44Wny1aq4xCYSqfQDw4=
-----END CERTIFICATE-----
}

root-chain: {
-----BEGIN CERTIFICATE-----
MIIESDCCAzCgAwIBAgIIJoJioe5Xq7gwDQYJKoZIhvcNAQELBQAwgYgxCzAJBgNV
BAYTAkNOMRUwEwYDVQQKEwxiaXRiZWdpbi5jb20xHzAdBgNVBAsTFmJpdGJlZ2lu
IHRlc3QgcnNhIHJvb3QxHjAcBgNVBAMTFXJzYS5yb290LmJpdGJlZ2luLmNvbTEh
MB8GCSqGSIb3DQEJAQwSYml0YmVnaW5AZ21haWwuY29tMB4XDTIwMDczMDAzMzYy
MVoXDTIxMDczMDAzMzYyMVowgYQxCzAJBgNVBAYTAkNOMRUwEwYDVQQKEwxiaXRi
ZWdpbi5jb20xHTAbBgNVBAsTFGJpdGJlZ2luIHRlc3QgcnNhIGNhMRwwGgYDVQQD
ExNyc2EuY2EuYml0YmVnaW4uY29tMSEwHwYJKoZIhvcNAQkBDBJiaXRiZWdpbkBn
bWFpbC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC1F909bb1a
vnxSKIx+vFrDAXKB79Y+OT2XZLUCpYRRrTJpVTv/yfyRuEtYg7SsUDsdBVrebF9M
LVd6bowe7qekkSCDdhzBeDkyQVMbHZODz6GLW9cPOivWGFjPfChjroOX6L36x78P
4XvlqAka8+rWRteNre+fRnHbB443QDNI2zV0iY6pD9OioqNXZ1sAvTf9ruK8hwR2
GSMnG2SUtUvD70UQF/m9RNTok9jZVmes1rwW68nkqJBa2wCy2E9VpoX72fjnR2eU
OxLLkBpqc6EtpieWkvQQ4BGy0YoVAdLr6/pbWzOZqIg3pnGNwnQbyLSFWH+P0Lp/
PZFZSRPUcMx1AgMBAAGjgbcwgbQwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQG
CCsGAQUFBwMBBggrBgEFBQcDAjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBSp
/mmonOZQiS1WB1roOvL9jSC2HzAfBgNVHSMEGDAWgBRKsjiyxs0LKPSUGChglCC/
EFb28TAyBgNVHREEKzApghNyc2EuY2EuYml0YmVnaW4uY29tgRJiaXRiZWdpbkBn
bWFpbC5jb20wDQYJKoZIhvcNAQELBQADggEBAB9JLHIWFnCsqogxZ4dRkyXEtGDF
dsefaLtUf+R1mjOQd7ns4L9oPap3f+n9drw4pokxXL3+HOC9pkzaU3bCajmOYhl2
K+OJefC6E+rCrh/9FhvRn09Jt8WUDrHZ7+hXAa9pUS6Shl6v/LSTay9GBpudidgy
FQowC5nRDmdI08yBHlSlblg7zw8PRnANcvJbZScpHNEPsJsE8mxvxiAJqWrTL+dD
zX9R1ROr5EWbnXV6Tm+FWR352isyWIcmye0FZ9PzhETJ4WaT2KowJ0bbsHS+GGTV
oCBWtJdAzVvXJqOqJ4tQj+izJODndGXI9LQ4Sfga8h94oDeb8otlAmlP+6k=
-----END CERTIFICATE-----
}

do [

;debug: :print
debug: :comment

max-count: 300000
count: 0
total: 0.0

print "Secure TCP client"

client: open tls://127.0.0.1:8123
;client: open tls://192.168.1.15:8123

client/extra: compose/deep [
    ;domain: "bitbegin.com"
    ;-- temporary
    accept-invalid-cert: (false)
    disable-builtin-roots: (true)
    roots: [(root-cert)]
    min-protocol: 0302h             ;-- min protocol sslv3,
    max-protocol: 0303h             ;-- max protocol tls1.2
]

start: now/precise
mbps: "?"

b: to-binary "Hello Red"

client/awake: func [event /local port] [
    debug ["=== Client event:" event/type]
    port: event/port
    switch event/type [
        connect [insert port b]
        read [
	        probe length? port/data
	        probe to-string port/data
	        insert port b
        ]
        wrote [copy port]
    ]
    false
]
if none? system/view [
	wait client
	close client
	print "Done"
]
]
